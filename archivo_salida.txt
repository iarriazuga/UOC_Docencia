



-- ARCHIVO: MODELS\DIM\DIM_RECURSOS_APRENENTATGE.SQL
CREATE OR REPLACE TABLE DB_UOC_PROD.DDP_DOCENCIA.DIM_RECURSOS_APRENENTATGE AS
FROM DB_UOC_PROD.DDP_DOCENCIA.DIM_RECURSOS_APRENENTATGE_COCO_PRODUCT_MODULS
FROM DB_UOC_PROD.DD_OD.STAGE_RECURSOS_APRENENTATGE_DIMAX
SELECT * FROM DIM_COCO_PRODUCTES_MODULS
SELECT  * FROM DIMAX;
CREATE OR REPLACE TEMP TABLE DB_UOC_PROD.DDP_DOCENCIA.T_COCO_PROD_TEMP_DUPLICATES_TEMP AS
FROM
FROM
DELETE FROM DB_UOC_PROD.DDP_DOCENCIA.DIM_RECURSOS_APRENENTATGE
FROM DB_UOC_PROD.DDP_DOCENCIA.T_COCO_PROD_TEMP_DUPLICATES_TEMP




-- ARCHIVO: MODELS\DIM\DIM_RECURSOS_APRENENTATGE_COCO_PRODUCT_MODULS.SQL
CREATE OR REPLACE TABLE DB_UOC_PROD.DDP_DOCENCIA.DIM_RECURSOS_APRENENTATGE_COCO_PRODUCT_MODULS AS
FROM DB_UOC_PROD.STG_DADESRA.AUTORS_PRODUCTE
JOIN DB_UOC_PROD.STG_DADESRA.AUTORS_SUPORT_PRODUCTE_I18N
JOIN DB_UOC_PROD.STG_DADESRA.AUTORS_TIPUS_TRAMESA_I18N
JOIN DB_UOC_PROD.STG_DADESRA.AUTORS_IDIOMA_PRODUCTE_I18N
FROM DB_UOC_PROD.STG_DADESRA.AUTORS_MODUL AUTORS_MODUL
JOIN PRODUCTOS_AUX AUTORS_PRODUCTE ON AUTORS_PRODUCTE.CODI_RECURS = AUTORS_MODUL.PRODUCTE_CREACIO_ID
SELECT * FROM MODULOS_AUX
SELECT * FROM PRODUCTOS_AUX
CREATE OR REPLACE TEMP TABLE DB_UOC_PROD.DDP_DOCENCIA.T_COCO_PROD_TEMP_DUPLICATES_TEMP AS
FROM
FROM
DELETE FROM DB_UOC_PROD.DDP_DOCENCIA.DIM_RECURSOS_APRENENTATGE_COCO_PRODUCT_MODULS
FROM DB_UOC_PROD.DDP_DOCENCIA.T_COCO_PROD_TEMP_DUPLICATES_TEMP




-- ARCHIVO: MODELS\DIM\DIM_RECURSOS_APRENENTATGE_DIMAX.SQL
CREATE OR REPLACE TABLE DB_UOC_PROD.DD_OD.STAGE_RECURSOS_APRENENTATGE_DIMAX (
CREATE OR REPLACE PROCEDURE DB_UOC_PROD.DD_OD.STAGE_RECURSOS_APRENENTATGE_DIMAX_LOADS()
FROM DB_UOC_PROD.STG_DADESRA.DIMAX_V_RECURS
JOIN DB_UOC_PROD.STG_DADESRA.DIMAX_RECURS_INFO_EXTRA
SELECT * FROM DB_UOC_PROD.DD_OD.STAGE_RECURSOS_APRENENTATGE_DIMAX2
SELECT * FROM DB_UOC_PROD.DD_OD.STAGE_RECURSOS_APRENENTATGE_DIMAX




-- ARCHIVO: MODELS\FACT\FACT_DADES_ACADEMIQUES_EVENTS.SQL
CREATE OR REPLACE TABLE DB_UOC_PROD.DDP_DOCENCIA.FACT_DADES_ACADEMIQUES_EVENTS AS
FROM  DB_UOC_PROD.DDP_DOCENCIA.POST_DADES_ACADEMIQUES DADES_ACADEMIQUES
JOIN DB_UOC_PROD.DDP_DOCENCIA.STAGE_LIVE_EVENTS_FLATENED EVENTS
SELECT * FROM TEMP_TABLE




-- ARCHIVO: MODELS\FACT\FACT_DADES_ACADEMIQUES_EVENTS_AGG.SQL
CREATE OR REPLACE TABLE DB_UOC_PROD.DDP_DOCENCIA.FACT_DADES_ACADEMIQUES_EVENTS_AGG AS
FROM  DB_UOC_PROD.DDP_DOCENCIA.FACT_DADES_ACADEMIQUES_EVENTS DADES_ACADEMIQUES
FROM AUXILIAR




-- ARCHIVO: MODELS\POST\POST_DADES_ACADEMIQUES.SQL
CREATE OR REPLACE TABLE DB_UOC_PROD.DDP_DOCENCIA.POST_DADES_ACADEMIQUES (
FROM DB_UOC_PROD.DDP_DOCENCIA.STAGE_DADES_ACADEMIQUES_COCO
FROM DB_UOC_PROD.DDP_DOCENCIA.STAGE_DADES_ACADEMIQUES_DIMAX
FROM AUX_TEMPORARY_TABLE
JOIN DB_UOC_PROD.DD_OD.DIM_ASSIGNATURA AS ASIGNATURA
JOIN DB_UOC_PROD.DD_OD.DIM_SEMESTRE AS SEMESTRE
JOIN DB_UOC_PROD.DDP_DOCENCIA.DIM_RECURSOS_APRENENTATGE AS RECURSOS




-- ARCHIVO: MODELS\STAGE\STAGE_DADES_ACADEMIQUES_COCO.SQL
CREATE OR REPLACE TABLE DB_UOC_PROD.DDP_DOCENCIA.STAGE_DADES_ACADEMIQUES_COCO AS
FROM DB_UOC_PROD.DD_OD.DIM_SEMESTRE SEMESTRE
JOIN   DB_UOC_PROD.STG_DADESRA.AUTORS_ELEMENT_FORMACIO ASIGNATURA
SELECT  CODI_FINAL, COUNT(*) FROM DB_UOC_PROD.STG_DADESRA.AUTORS_ELEMENT_FORMACIO  GROUP BY 1  ORDER BY 2 DESC
SELECT  DIM_SEMESTRE_KEY, COUNT(*) FROM DB_UOC_PROD.DD_OD.DIM_SEMESTRE SEMESTRE  GROUP BY 1  ORDER BY 2 DESC
FROM DB_UOC_PROD.STG_DADESRA.AUTORS_PRODUCTES_VERSIONS PRODUCTOS_PLAN_PUBLICACION
JOIN DB_UOC_PROD.STG_DADESRA.AUTORS_VERSIO PLAN_PUBLICACION
JOIN DB_UOC_PROD.STG_DADESRA.AUTORS_ELEMENT_FORMACIO  ASIGNATURA
JOIN DB_UOC_PROD.STG_DADESRA.AUTORS_PERIODE SEMESTRE
JOIN   DB_UOC_PROD.DDP_DOCENCIA.DIM_RECURSOS_COCO_PRODUCT_MODULS COCO_PRODUCTS
FROM  CROSS_SEMESTRE_ASIGNATURA
JOIN SEMESTRES_INFORMADOS
FROM CROSS_SEMESTRES_INFORMADOS
FROM INFORMED_SEMESTERS IS2
FROM CROSS_SEMESTRES_INFORMADOS CSI
FROM ULTIMO_SEMESTRE_INFORMADO SWR
JOIN INFORMED_SEMESTERS INF
FROM PROPAGACION_ULTIMO_SEMESTRE_INFORMADO




-- ARCHIVO: MODELS\STAGE\STAGE_DADES_ACADEMIQUES_DIMAX.SQL
CREATE OR REPLACE TABLE DB_UOC_PROD.DDP_DOCENCIA.STAGE_DADES_ACADEMIQUES_DIMAX AS
FROM DB_UOC_PROD.STG_DADESRA.DIMAX_RESOFITE_PATH
FROM DIMAX_RESOFITE_PATH_UNIFIED
JOIN DB_UOC_PROD.STG_DADESRA.DIMAX_ITEM_DIMAX
FROM NODE_STRUCTURE_APLANATION
FROM NODE_STRUCTURE_APLANATION
FROM  NODE_STRUCTURE_ASIGNATURAS
JOIN NODE_STRUCTURE_SEMESTRES ON  NODE_STRUCTURE_ASIGNATURAS.NODE_RECURS_SEMESTRE = NODE_STRUCTURE_SEMESTRES.NODE_RECURS_SEMESTRE




-- ARCHIVO: MODELS\STAGE\STAGE_LIVE_EVENTS_FLATENED.SQL
CREATE OR REPLACE TABLE DB_UOC_PROD.DDP_DOCENCIA.STAGE_LIVE_EVENTS_FLATENED_AUX AS
FROM  DB_UOC_PROD.STG_DADESRA.LIVE_EVENTS_CALIPER_DUMMY LE
SELECT * FROM AUX_CTE_TABLE
CREATE OR REPLACE TABLE DB_UOC_PROD.DDP_DOCENCIA.STAGE_LIVE_EVENTS_FLATENED (
TRY_CAST(CODI_RECURS AS INT) IN (SELECT CODI_RECURS FROM DB_UOC_PROD.DDP_DOCENCIA.DIM_RECURSOS_APRENENTATGE_COCO_PRODUCT_MODULS)
TRY_CAST(CODI_RECURS AS INT) IN (SELECT CODI_RECURS FROM DB_UOC_PROD.DD_OD.STAGE_RECURSOS_APRENENTATGE_DIMAX)
WHEN TRY_CAST(CODI_RECURS AS INT) IN (SELECT CODI_RECURS FROM DB_UOC_PROD.DD_OD.STAGE_RECURSOS_APRENENTATGE_DIMAX)  THEN 'DIMAX'
WHEN TRY_CAST(CODI_RECURS AS INT) IN (SELECT CODI_RECURS FROM DB_UOC_PROD.DDP_DOCENCIA.DIM_RECURSOS_APRENENTATGE_COCO_PRODUCT_MODULS)   THEN 'COCO'
FROM DB_UOC_PROD.DDP_DOCENCIA.STAGE_LIVE_EVENTS_FLATENED_AUX
FROM AUX_CTE_TABLE




-- ARCHIVO: MODELS\VERIFICATION_TABLES\ANALISIS_DIM_ASSIGNATURA.SQL
CREATE OR REPLACE TEMP TABLE DB_UOC_PROD.DDP_DOCENCIA.ANALISIS_ASSIGNATURA_EVENTS AS
FROM DB_UOC_PROD.DDP_DOCENCIA.STAGE_LIVE_EVENTS_FLATENED
WHEN DIM_ASSIGNATURA_KEY IN (SELECT DIM_ASSIGNATURA_KEY FROM DB_UOC_PROD.DD_OD.DIM_ASSIGNATURA)  THEN 'ASIGNATURA'
FROM AUX
FROM  CODI_ASIGNATURA_VALORATION




JOIN_DADES_ACADEMIQUES.SQL
FROM  DB_UOC_PROD.DDP_DOCENCIA.POST_DADES_ACADEMIQUES DADES_ACADEMIQUES
JOIN DB_UOC_PROD.DDP_DOCENCIA.STAGE_LIVE_EVENTS_FLATENED EVENTS
FROM TEMP_TABLE_DIM_KEY
FROM  DB_UOC_PROD.DDP_DOCENCIA.STAGE_LIVE_EVENTS_FLATENED EVENTS
JOIN  DB_UOC_PROD.DDP_DOCENCIA.POST_DADES_ACADEMIQUES DADES_ACADEMIQUES
FROM TEMP_TABLE_DIM_KEY
FROM COMPROBACION
AND EVENT_CODI_RECURS NOT IN ( SELECT CODI_RECURS FROM DB_UOC_PROD.DDP_DOCENCIA.POST_DADES_ACADEMIQUES   )
FROM DB_UOC_PROD.DDP_DOCENCIA.POST_DADES_ACADEMIQUES DADES_ACADEMIQUES
FROM DB_UOC_PROD.DDP_DOCENCIA.POST_DADES_ACADEMIQUES DADES_ACADEMIQUES
FROM DB_UOC_PROD.DDP_DOCENCIA.DIM_RECURSOS_APRENENTATGE
FROM DB_UOC_PROD.STG_DADESRA.AUTORS_PRODUCTES_VERSIONS PRODUCTOS_PLAN_PUBLICACION
FROM  DB_UOC_PROD.STG_DADESRA.DIMAX_RESOFITE_PATH
FROM DB_UOC_PROD.DDP_DOCENCIA.DIM_RECURSOS_APRENENTATGE




-- ARCHIVO: MODELS\VERIFICATION_TABLES\ANALISIS_RESOURCES_CALIPER_EVENTS.SQL
CREATE OR REPLACE TEMP TABLE DB_UOC_PROD.DDP_DOCENCIA.ANALISIS_RESOURCES_CALIPER_EVENTS AS
FROM DB_UOC_PROD.DDP_DOCENCIA.STAGE_LIVE_EVENTS_FLATENED
SELECT * FROM DB_UOC_PROD.DDP_DOCENCIA.STAGE_LIVE_EVENTS_FLATENED LIMIT 100
SELECT SOURCE_EVENT, COUNT(*) FROM AUX GROUP BY 1 ORDER BY 2 DESC
TRY_CAST(CODI_RECURS AS INT) IN (SELECT CODI_RECURS FROM DB_UOC_PROD.DDP_DOCENCIA.DIM_RECURSOS_APRENENTATGE_COCO_PRODUCT_MODULS)
TRY_CAST(CODI_RECURS AS INT) IN (SELECT CODI_RECURS FROM DB_UOC_PROD.DD_OD.STAGE_RECURSOS_APRENENTATGE_DIMAX)
WHEN TRY_CAST(CODI_RECURS AS INT) IN (SELECT CODI_RECURS FROM DB_UOC_PROD.DD_OD.STAGE_RECURSOS_APRENENTATGE_DIMAX)  THEN 'DIMAX'
WHEN TRY_CAST(CODI_RECURS AS INT) IN (SELECT CODI_RECURS FROM DB_UOC_PROD.DDP_DOCENCIA.DIM_RECURSOS_APRENENTATGE_COCO_PRODUCT_MODULS)   THEN 'COCO'
FROM AUX
SELECT CODI_RECURS_ORIGEN , COUNT(*) FROM CODI_RECURS_VALORATION GROUP BY 1 ORDER BY 2 DESC
FROM CODI_RECURS_VALORATION




-- ARCHIVO: MODELS\VERIFICATION_TABLES\REUNION.SQL
FROM DB_UOC_PROD.DDP_DOCENCIA.ANALISIS_RESOURCES_CALIPER_EVENTS
FROM  DB_UOC_PROD.DDP_DOCENCIA.ANALISIS_ASSIGNATURA_EVENTS




-- ARCHIVO: MODELS\VERIFICATION_TABLES\VERIFICATION_ANALISIS_RESOURCES_CALIPER_EVENTS_QUERIES.SQL
SELECT CODI_RECURS_ORIGEN , COUNT(*) FROM CODI_RECURS_VALORATION GROUP BY 1 ORDER BY 2 DESC
FROM DB_UOC_PROD.DDP_DOCENCIA.STAGE_LIVE_EVENTS_FLATENED
SELECT * FROM DB_UOC_PROD.STG_DADESRA.AUTORS_PRODUCTE
SELECT * FROM DB_UOC_PROD.STG_DADESRA.AUTORS_MODUL AUTORS_MODUL
FROM DB_UOC_PROD.STG_DADESRA.DIMAX_V_RECURS
FROM DB_UOC_PROD.DDP_DOCENCIA.STAGE_LIVE_EVENTS_FLATENED EVE
JOIN DB_UOC_PROD.DDP_DOCENCIA.DIM_RECURSOS_APRENENTATGE REC
FROM AUX
FROM DB_UOC_PROD.DDP_DOCENCIA.DIM_RECURSOS_APRENENTATGE
DELETE FROM DB_UOC_PROD.DDP_DOCENCIA.DIM_RECURSOS_APRENENTATGE
FROM DB_UOC_PROD.DDP_DOCENCIA.DIM_RECURSOS_APRENENTATGE
FROM DB_UOC_PROD.DDP_DOCENCIA.STAGE_LIVE_EVENTS_FLATENED EVE
JOIN DB_UOC_PROD.DDP_DOCENCIA.DIM_RECURSOS_APRENENTATGE REC
FROM AUX
FROM DB_UOC_PROD.DDP_DOCENCIA.DIM_RECURSOS_APRENENTATGE
FROM DB_UOC_PROD.DDP_DOCENCIA.DIM_RECURSOS_APRENENTATGE
